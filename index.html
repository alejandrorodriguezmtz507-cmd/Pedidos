<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pedidos Caf√©</title>
<style>
body { 
  font-family: Arial; 
  background: #fff8f0; 
  padding: 20px; 
}
h1, h2 { 
  text-align: center; 
  color: #8b2e2e; 
}
form { 
  max-width: 400px; 
  margin: 20px auto; 
  padding: 20px; 
  background: #fff; 
  border-radius: 10px; 
  box-shadow: 0 2px 6px rgba(0,0,0,0.2); 
}
label { 
  display:block; 
  margin-top:10px; 
  font-weight:bold; 
}
input, select, textarea { 
  width:100%; 
  padding:8px; 
  margin-top:5px; 
  border-radius:5px; 
  border:1px solid #ccc; 
}
button { 
  background:#8b2e2e; 
  color:white; 
  padding:10px; 
  margin-top:15px; 
  width:100%; 
  border:none; 
  border-radius:5px; 
  cursor:pointer; 
}
button:hover { 
  background:#a13c3c; 
}
.msg { 
  text-align:center; 
  font-weight:bold; 
  margin-top:20px; 
  font-size:16px; 
  color:#333; 
}
#resumen { 
  max-width: 400px; 
  margin: 20px auto; 
  padding: 10px; 
  background: #fff4f0; 
  border-radius: 8px; 
}
.resumen-item { 
  border-bottom: 1px solid #ccc; 
  padding:5px 0; 
}
.logo-container {
  text-align: center;
  margin-bottom: 10px;
}
.logo-container img {
  width: 250px;
  border-radius: 10px;
  display: inline-block;
  box-shadow: 0 0 8px rgba(0,0,0,0.2);
}
</style>
</head>
<body>

<!-- üîπ LOGO desde Google Drive -->
<div class="logo-container">
  <img src="https://drive.google.com/uc?export=view&id=1MCoGP1Nk9ghRwKfmKo9HyZ2Nc8Sards0" alt="Coffe Dreams Logo">
</div>

<h1>Coffe Dreams</h1>
<h2>Formulario Solicitud de Producto</h2>

<form id="pedidoForm">
  <label>Nombre del cliente</label>
  <input type="text" id="nombre" required>

  <label>Direcci√≥n de entrega</label>
  <input type="text" id="direccion" required>

  <label>Fecha de entrega</label>
  <input type="date" id="fechaEntrega" required>

  <label>Producto</label>
  <select id="producto">
    <option value="Caf√© individual">Caf√© individual - $60</option>
    <option value="Caf√© + Pastel">Caf√© + Pastel - $120</option>
    <option value="Pastel">Pastel - $60</option>
    <option value="Late oreo">Late oreo - $50</option>
  </select>

  <label>Cantidad</label>
  <input type="number" id="cantidad" value="1" min="1">

  <label>Comentarios de referencia</label>
  <textarea id="comentarios" rows="3" placeholder="Ej. Dejar en porter√≠a, tocar timbre..."></textarea>

  <button type="button" id="agregarPedido">Agregar Pedido</button>
  <button type="button" id="enviarPedidos">Enviar Pedido</button>
</form>

<div id="resumen"></div>
<div class="msg" id="msg"></div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxNes97vClzV8lQqXfAynOxHo2nwFYDUXzDmomqvT8u_ACAnBtClKct1C7_u0SNl735bw/exec";
let pedidosTemp = [];

const hoy = new Date().toISOString().split("T")[0];
document.getElementById("fechaEntrega").setAttribute("min", hoy);

function calcularTotal(producto, cantidad){
  let precio = 0;
  if(producto === "Caf√© individual") precio = 60;
  if(producto === "Caf√© + Pastel") precio = 120;
  if(producto === "Pastel") precio = 60;
  if(producto === "Late oreo") precio = 50;
  return precio * cantidad;
}

function actualizarResumen(){
  const div = document.getElementById("resumen");
  if(pedidosTemp.length === 0){
    div.innerHTML = "";
    return;
  }
  let html = "<h3>Resumen del Pedido:</h3>";
  pedidosTemp.forEach((p,i) => {
    html += `<div class="resumen-item">
      ${i+1}. <b>${p.nombre}</b> - ${p.producto} x ${p.cantidad} ‚Üí $${p.total}<br>
      üìç ${p.direccion}<br>
      üìÖ Entrega: ${p.fechaEntrega}<br>
      üìù ${p.comentarios || "Sin comentarios"}
      <button onclick="eliminarTemp(${i})" style="float:right;">Eliminar</button>
    </div>`;
  });
  const totalGeneral = pedidosTemp.reduce((acc,p)=>acc+p.total,0);
  html += `<div style="font-weight:bold; margin-top:5px;">Total General: $${totalGeneral}</div>`;
  div.innerHTML = html;
}

function eliminarTemp(index){
  pedidosTemp.splice(index,1);
  actualizarResumen();
}

document.getElementById("agregarPedido").addEventListener("click", ()=>{
  const nombre = document.getElementById("nombre").value.trim();
  const direccion = document.getElementById("direccion").value.trim();
  const fechaEntrega = document.getElementById("fechaEntrega").value;
  if(nombre === "" || direccion === "" || fechaEntrega === ""){
    alert("Ingrese nombre, direcci√≥n y fecha de entrega");
    return;
  }
  const producto = document.getElementById("producto").value;
  const cantidad = parseInt(document.getElementById("cantidad").value);
  const comentarios = document.getElementById("comentarios").value.trim();
  const total = calcularTotal(producto, cantidad);

  pedidosTemp.push({nombre, direccion, fechaEntrega, producto, cantidad, comentarios, total});
  actualizarResumen();
  document.getElementById("cantidad").value = 1;
  document.getElementById("comentarios").value = "";
});

document.getElementById("enviarPedidos").addEventListener("click", ()=>{
  if(pedidosTemp.length === 0){
    alert("No hay pedidos para enviar");
    return;
  }

  let confirmacion = confirm("¬øDesea confirmar y enviar el pedido?");
  if(!confirmacion) return;

  Promise.all(pedidosTemp.map(pedido => 
    fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify(pedido) })
      .then(res => res.text())
  ))
  .then(responses => {
    document.getElementById("msg").innerHTML = `‚úÖ Pedido enviado correctamente.`;

    // üîπ Enviar WhatsApp autom√°ticamente
    let mensaje = "Hola, me gustar√≠a confirmar mi pedido:%0A%0A";
    pedidosTemp.forEach((p,i)=>{
      mensaje += `${i+1}. ${p.producto} x ${p.cantidad} = $${p.total}%0AEntrega: ${p.fechaEntrega}%0A${p.direccion}%0A${p.comentarios || "Sin comentarios"}%0A%0A`;
    });
    const totalGeneral = pedidosTemp.reduce((acc,p)=>acc+p.total,0);
    mensaje += `Total: $${totalGeneral}`;

    const numero = "528442461162"; // N√∫mero de WhatsApp (M√©xico)
    const url = `https://wa.me/${numero}?text=${mensaje}`;
    window.open(url, "_blank");

    pedidosTemp = [];
    actualizarResumen();
    document.getElementById("pedidoForm").reset();
    document.getElementById("fechaEntrega").setAttribute("min", hoy);
  })
  .catch(err => alert("Error al enviar pedidos: " + err));
});
</script>

</body>
</html>
